
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

    <title>Quickstarter &#8212; stitches documentation</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" href="../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/clipboard.min.js"></script>
    <script src="../_static/copybutton.js"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Tutorial" href="tutorial.html" />
    <link rel="prev" title="Installation" href="installation.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../index.html">
      
      
      <img src="../_static/../_static/logo_stitches.png" class="logo" alt="logo">
      
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Getting Started
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="installation.html">
   Installation
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Quickstarter
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="tutorial.html">
   Tutorial
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Python API
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/api.html">
   Python API
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Contributing
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../reference/contributing.html">
   Contributing to
   <strong>
    stitches
   </strong>
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Theme by the <a href="https://ebp.jupyterbook.org">Executable Book Project</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/JGCRI/stitches"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/JGCRI/stitches/issues/new?title=Issue%20on%20page%20%2Fgetting-started/stitches-quickstart.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/JGCRI/stitches/edit/master/docs/source/getting-started/stitches-quickstart.rst"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Edit this page"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-pencil-alt"></i>
  </span>
<span class="headerbtn__text-container">suggest edit</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../_sources/getting-started/stitches-quickstart.rst.txt"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.rst</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-the-package-data-from-zenodo">
   Install the package data from Zenodo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-1-emulate-global-mean-air-temperature">
   Example 1: Emulate global mean air temperature
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-set-up">
     Example Set Up
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decide-on-the-archive-data">
       Decide on the archive data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modify-inputs-decide-on-the-target-data">
       Modify Inputs - Decide on the target data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modify-inputs-prepare-target-data-for-matching">
       Modify Inputs - Prepare target data for matching
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-the-target-data-and-archive-data-to-make-the-recipes-using-the-function-make-recipe">
       Use the target_data and archive_data to make the recipes using the function
       <code class="docutils literal notranslate">
        <span class="pre">
         make_recipe()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#visualize-results">
       Visualize Results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#now-lets-compare-the-stitched-products-with-the-actual-canesm5-ssp245-data">
       Now let’s compare the stitched products with the actual CanESM5 SSP245 data
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-2-stitching-gridded-products-for-multiple-variables">
   Example 2: stitching gridded products for multiple variables.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#match-and-stitch">
     Match and stitch
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-generated-data">
     Load generated data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetch-target-data-from-pangeo-for-comparison">
     Fetch target data from pangeo for comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize">
     Visualize
    </a>
   </li>
  </ul>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Quickstarter</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#getting-started">
   Getting Started
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#install-the-package-data-from-zenodo">
   Install the package data from Zenodo
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-1-emulate-global-mean-air-temperature">
   Example 1: Emulate global mean air temperature
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#example-set-up">
     Example Set Up
    </a>
    <ul class="nav section-nav flex-column">
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#decide-on-the-archive-data">
       Decide on the archive data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modify-inputs-decide-on-the-target-data">
       Modify Inputs - Decide on the target data
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#modify-inputs-prepare-target-data-for-matching">
       Modify Inputs - Prepare target data for matching
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#use-the-target-data-and-archive-data-to-make-the-recipes-using-the-function-make-recipe">
       Use the target_data and archive_data to make the recipes using the function
       <code class="docutils literal notranslate">
        <span class="pre">
         make_recipe()
        </span>
       </code>
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#visualize-results">
       Visualize Results
      </a>
     </li>
     <li class="toc-h4 nav-item toc-entry">
      <a class="reference internal nav-link" href="#now-lets-compare-the-stitched-products-with-the-actual-canesm5-ssp245-data">
       Now let’s compare the stitched products with the actual CanESM5 SSP245 data
      </a>
     </li>
    </ul>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#example-2-stitching-gridded-products-for-multiple-variables">
   Example 2: stitching gridded products for multiple variables.
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#match-and-stitch">
     Match and stitch
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#load-generated-data">
     Load generated data
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#fetch-target-data-from-pangeo-for-comparison">
     Fetch target data from pangeo for comparison
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#visualize">
     Visualize
    </a>
   </li>
  </ul>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section id="quickstarter">
<h1>Quickstarter<a class="headerlink" href="#quickstarter" title="Permalink to this heading">#</a></h1>
<p>The purpose of this tutorial is to demonstrate how <code class="docutils literal notranslate"><span class="pre">stitches</span></code> can be
used as an emulator. While <code class="docutils literal notranslate"><span class="pre">stitches</span></code> can emulate a number of CMIP6
models this example will focus on emulating CanESM5 SSP245 results.</p>
<p>To use <code class="docutils literal notranslate"><span class="pre">stitches</span></code>, there are a number of decisions users have to make,
perhaps the most important being:</p>
<ul class="simple">
<li><p>Which ESM will <code class="docutils literal notranslate"><span class="pre">stitches</span></code> emulate?</p></li>
<li><p>What archive data will be used? These are values that the target data
will be matched to. It should only contain data for the specific ESM
that is being emulated. Users may limit the number of experiments or
ensemble realizations within the archive in order to achieve their
specific experimental setup.</p></li>
<li><p>What target data will be used? This data frame represents the
temperature pathway the stitched product will follow. The contents of
this data frame may come from CMIP6 ESM results for an SSP or it may
follow some arbitrary pathway.</p></li>
</ul>
<p>A diagram illustrating the <code class="docutils literal notranslate"><span class="pre">stitches</span></code> process is included for
reference:</p>
<figure class="align-default" id="id1">
<img alt="stitches workflow" src="../_images/stitches_diagram.jpg" />
<figcaption>
<p><span class="caption-text">stitches workflow</span><a class="headerlink" href="#id1" title="Permalink to this image">#</a></p>
</figcaption>
</figure>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">stitches</span></code> defaults to <span class="math notranslate nohighlight">\(X=9\)</span> year windows.</p></li>
</ul>
<section id="getting-started">
<h2>Getting Started<a class="headerlink" href="#getting-started" title="Permalink to this heading">#</a></h2>
<p>Start by loading the stitches package (see <a class="reference external" href="https://github.com/jgcri/stitches">installation
instructions</a> if <code class="docutils literal notranslate"><span class="pre">stitches</span></code> is
not yet installed).</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">stitches</span>
</pre></div>
</div>
<p>Load the additional python libraries that will be used in this example.
These packages are installed as <code class="docutils literal notranslate"><span class="pre">stitches</span></code> dependencies.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pkg_resources</span>
<span class="kn">import</span> <span class="nn">warnings</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>



<span class="c1"># For help with plotting</span>
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="o">%</span><span class="k">config</span> InlineBackend.figure_format = &#39;retina&#39;
<span class="n">plt</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s1">&#39;figure.figsize&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">6</span>
</pre></div>
</div>
</section>
<section id="install-the-package-data-from-zenodo">
<h2>Install the package data from Zenodo<a class="headerlink" href="#install-the-package-data-from-zenodo" title="Permalink to this heading">#</a></h2>
<p>The package data is all data that has been processed from raw Pangeo
data and is generated with package functions. For convenience and rapid
cloning of the github repository, the package data is also minted on
Zenodo and can be quickly downloaded for using the package.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stitches</span><span class="o">.</span><span class="n">install_package_data</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="example-1-emulate-global-mean-air-temperature">
<h2>Example 1: Emulate global mean air temperature<a class="headerlink" href="#example-1-emulate-global-mean-air-temperature" title="Permalink to this heading">#</a></h2>
<p>We will begin with an example focused on emulating global mean air
temperature before moving on to an example producing gridded data for
multiple variables.</p>
<p>The global mean air temperature (GSAT) is the key variable upon which
<code class="docutils literal notranslate"><span class="pre">stitches</span></code> operates to construct new realizations, with the added
benefit that it is easy to visualize.</p>
<section id="example-set-up">
<h3>Example Set Up<a class="headerlink" href="#example-set-up" title="Permalink to this heading">#</a></h3>
<p>In this example, we will use <code class="docutils literal notranslate"><span class="pre">stitches</span></code> to emulate CanESM5 SSP245
results. Then we will compare the <code class="docutils literal notranslate"><span class="pre">stitches</span></code> results with actual CMIP6
CanESM5 SSP245 output data.</p>
<section id="decide-on-the-archive-data">
<h4>Decide on the archive data<a class="headerlink" href="#decide-on-the-archive-data" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>Limit the archive matching data to the model we are trying to
emulate, CanESM5 in this case.</p></li>
<li><p>In this example, we treat SSP245 as a novel scenario rather than one
run by the ESM and available, so we exclude it from the archive data.</p></li>
<li><p>The internal package data called <code class="docutils literal notranslate"><span class="pre">matching_archive</span></code> contains the
temperature results for all the ESMs-Scenarios-ensemble members that
are available for <code class="docutils literal notranslate"><span class="pre">stitches</span></code> to use in its matching process. In
this file monthly, tas output has been processed to mean temperature
anomaly and the temperature change over a window of time. By default
<code class="docutils literal notranslate"><span class="pre">stitches</span></code> uses a 9-year window.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># read in the package data of all ESMs-Scenarios-ensemble members avail.</span>
<span class="n">data_directory</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;stitches&#39;</span><span class="p">,</span> <span class="s2">&quot;data&quot;</span><span class="p">)</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_directory</span><span class="p">,</span> <span class="s1">&#39;matching_archive.csv&#39;</span><span class="p">)</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">path</span><span class="p">)</span>

<span class="n">archive_data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ssp126&#39;</span><span class="p">,</span>  <span class="s1">&#39;ssp370&#39;</span><span class="p">,</span> <span class="s1">&#39;ssp585&#39;</span><span class="p">]))</span>
                       <span class="o">&amp;</span> <span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CanESM5&quot;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
</section>
<section id="modify-inputs-decide-on-the-target-data">
<h4>Modify Inputs - Decide on the target data<a class="headerlink" href="#modify-inputs-decide-on-the-target-data" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>The primary input to <code class="docutils literal notranslate"><span class="pre">stitches</span></code> functions that most users will
adjust is the target data.</p></li>
<li><p>The target data is the temperature pathway the stitched (emulated)
product will follow. This data can come from an ESM or another class
of climate models, for a specific SSP scenario or an arbitrarily
defined scenario. Similarly to the archive data, the target data
should contain the mean temperature anomaly and rate of temperature
change over a window of time. The target data window and the archive
window must be the same length, <code class="docutils literal notranslate"><span class="pre">stitches</span></code> uses a 9-year window by
default.</p></li>
<li><p>In this example because we are demonstrating <code class="docutils literal notranslate"><span class="pre">stitches</span></code> ability to
emulate CanESM5 SSP245, we will use CanESM5 SSP245 results for a
single ensemble member to use as our target data.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load time series and subset to target time series if needed:</span>
<span class="n">targ</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">data_directory</span><span class="p">,</span> <span class="s2">&quot;tas-data&quot;</span><span class="p">,</span> <span class="s2">&quot;CanESM5_tas.csv&quot;</span><span class="p">))</span>
<span class="n">target_data</span> <span class="o">=</span> <span class="n">targ</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">targ</span><span class="p">[</span><span class="s2">&quot;model&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;CanESM5&quot;</span><span class="p">)</span>
                       <span class="o">&amp;</span> <span class="p">(</span><span class="n">targ</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;ssp245&#39;</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">target_data</span>  <span class="o">=</span> <span class="n">target_data</span><span class="p">[</span><span class="n">target_data</span><span class="p">[</span><span class="s2">&quot;ensemble&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">])]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">target_data</span> <span class="o">=</span> <span class="n">target_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="s1">&#39;zstore&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Take a look at the structure and a plot of the time series we will be
targeting:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">target_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
<span class="n">target_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>  <span class="n">variable</span> <span class="n">experiment</span>  <span class="n">ensemble</span>    <span class="n">model</span>  <span class="n">year</span>     <span class="n">value</span>
<span class="mi">0</span>      <span class="n">tas</span>     <span class="n">ssp245</span>  <span class="n">r1i1p1f1</span>  <span class="n">CanESM5</span>  <span class="mi">1850</span> <span class="o">-</span><span class="mf">1.133884</span>
<span class="mi">1</span>      <span class="n">tas</span>     <span class="n">ssp245</span>  <span class="n">r1i1p1f1</span>  <span class="n">CanESM5</span>  <span class="mi">1851</span> <span class="o">-</span><span class="mf">1.389375</span>
<span class="mi">2</span>      <span class="n">tas</span>     <span class="n">ssp245</span>  <span class="n">r1i1p1f1</span>  <span class="n">CanESM5</span>  <span class="mi">1852</span> <span class="o">-</span><span class="mf">1.318175</span>
<span class="mi">3</span>      <span class="n">tas</span>     <span class="n">ssp245</span>  <span class="n">r1i1p1f1</span>  <span class="n">CanESM5</span>  <span class="mi">1853</span> <span class="o">-</span><span class="mf">1.163771</span>
<span class="mi">4</span>      <span class="n">tas</span>     <span class="n">ssp245</span>  <span class="n">r1i1p1f1</span>  <span class="n">CanESM5</span>  <span class="mi">1854</span> <span class="o">-</span><span class="mf">1.302066</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/output_13_1.png"><img alt="../_images/output_13_1.png" src="../_images/output_13_1.png" style="width: 980px; height: 525px;" /></a>
<ul class="simple">
<li><p>Any time series of global average temperature anomalies can be used
as a target. However, the data frame containing this time series must
be structured as above: a <code class="docutils literal notranslate"><span class="pre">variable</span></code> column containing entries of
‘tas’, <code class="docutils literal notranslate"><span class="pre">year</span></code> and <code class="docutils literal notranslate"><span class="pre">value</span></code> columns containing the data, and
<code class="docutils literal notranslate"><span class="pre">experiment</span></code>, <code class="docutils literal notranslate"><span class="pre">ensemble</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code> columns with identifying
information of the source of this target data.</p></li>
<li><p>The actual entries in the <code class="docutils literal notranslate"><span class="pre">experiment</span></code>, <code class="docutils literal notranslate"><span class="pre">ensemble</span></code>, <code class="docutils literal notranslate"><span class="pre">model</span></code>
columns are only used for generating identifying strings for
generated ensemble members.</p></li>
<li><p>In this demonstration, we will specifically be targeting ensemble
member 1 of the CanESM5 SSP245 simulations. The entire SSP245
ensemble may be jointly targeted by omitting the line
<code class="docutils literal notranslate"><span class="pre">target_data</span>&#160; <span class="pre">=</span> <span class="pre">target_data[target_data[&quot;ensemble&quot;].isin(['r1i1p1f1'])].copy()</span></code></p></li>
</ul>
</section>
<section id="modify-inputs-prepare-target-data-for-matching">
<h4>Modify Inputs - Prepare target data for matching<a class="headerlink" href="#modify-inputs-prepare-target-data-for-matching" title="Permalink to this heading">#</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">stitches</span></code> includes functions that convert the above data frame of raw
target data into correctly structured target data for matching.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># First, smooth the target data</span>
<span class="n">target_data</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fx_processing</span><span class="o">.</span><span class="n">calculate_rolling_mean</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span>
                                                            <span class="n">size</span><span class="o">=</span><span class="mi">31</span><span class="p">)</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">target_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;value&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># then process so it can be matched on:</span>
<span class="n">target_data</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fx_processing</span><span class="o">.</span><span class="n">get_chunk_info</span><span class="p">(</span>
    <span class="n">stitches</span><span class="o">.</span><span class="n">fx_processing</span><span class="o">.</span><span class="n">chunk_ts</span><span class="p">(</span><span class="n">df</span> <span class="o">=</span> <span class="n">target_data</span><span class="p">,</span>  <span class="n">n</span><span class="o">=</span><span class="mi">9</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/output_16_0.png"><img alt="../_images/output_16_0.png" src="../_images/output_16_0.png" style="width: 980px; height: 525px;" /></a>
</section>
<section id="use-the-target-data-and-archive-data-to-make-the-recipes-using-the-function-make-recipe">
<h4>Use the target_data and archive_data to make the recipes using the function <code class="docutils literal notranslate"><span class="pre">make_recipe()</span></code><a class="headerlink" href="#use-the-target-data-and-archive-data-to-make-the-recipes-using-the-function-make-recipe" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>We ask for 4 new realizations to be constructed, and we specify that
the matching be limited to a <code class="docutils literal notranslate"><span class="pre">tol</span></code> (<span class="math notranslate nohighlight">\(Z\)</span> in the diagram) value
of 0.06degC.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">tol</span></code> is the parameter that effectively controls both the maximum
number of generated time series that may be constructed and the
quality of matches.</p></li>
<li><p>For large values of <code class="docutils literal notranslate"><span class="pre">tol</span></code>, the matches constructed may be no good.
Currently, the cutoff values of <code class="docutils literal notranslate"><span class="pre">tol</span></code> for each ESM are determined
by post-hoc calculation, as described in the ESD paper.</p></li>
<li><p>we use the <code class="docutils literal notranslate"><span class="pre">reproducible</span></code> argument so that the results are
reproducible. It is not required and can be set to <code class="docutils literal notranslate"><span class="pre">False</span></code> to have
a random draw of generated recipes</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_recipes</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">make_recipe</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span>
                                  <span class="n">archive_data</span><span class="p">,</span>
                                  <span class="n">tol</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span>
                                  <span class="n">N_matches</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
                                  <span class="n">reproducible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>Now use the recipe to get the global mean air temperature using
<code class="docutils literal notranslate"><span class="pre">gmat_stitching</span></code>. The data frame returned by <code class="docutils literal notranslate"><span class="pre">gmat_stitching</span></code> will
contain the final stitched product.</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stitched_global_temp</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">gmat_stitching</span><span class="p">(</span><span class="n">my_recipes</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="visualize-results">
<h4>Visualize Results<a class="headerlink" href="#visualize-results" title="Permalink to this heading">#</a></h4>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">groups</span> <span class="o">=</span> <span class="n">stitched_global_temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;stitching_id&#39;</span><span class="p">)</span>

<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Stitched Global Mean Temperature&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/output_22_0.png"><img alt="../_images/output_22_0.png" src="../_images/output_22_0.png" style="width: 999px; height: 546px;" /></a>
</section>
<section id="now-lets-compare-the-stitched-products-with-the-actual-canesm5-ssp245-data">
<h4>Now let’s compare the stitched products with the actual CanESM5 SSP245 data<a class="headerlink" href="#now-lets-compare-the-stitched-products-with-the-actual-canesm5-ssp245-data" title="Permalink to this heading">#</a></h4>
<ul class="simple">
<li><p>The black curve is realization 1 - the ESM data that this notebook
actually targeted.</p></li>
<li><p>The gray curves are the other archived realizations of SSP245 for
CanESM5 to illustrate that the generated ensemble members do not
systematically depart from the actual ensemble behavior.</p></li>
<li><p>GSAT data is included as package data in <code class="docutils literal notranslate"><span class="pre">stitches</span></code> for
convenience.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Load the comparison GSAT data</span>
<span class="n">data_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;stitches&#39;</span><span class="p">,</span> <span class="s1">&#39;data/tas-data/CanESM5_tas.csv&#39;</span><span class="p">)</span>

<span class="n">comp_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_path</span><span class="p">)</span>
<span class="n">comp_data</span> <span class="o">=</span> <span class="n">comp_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">comp_data</span><span class="p">[</span><span class="s2">&quot;experiment&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;ssp245&quot;</span><span class="p">]</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># full ensemble of actual ESM runs:</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">comp_data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;ensemble&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="k">if</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">ensemble</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">):</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;black&quot;</span><span class="p">,</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="mf">2.0</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">color</span> <span class="o">=</span> <span class="s2">&quot;0.5&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>

<span class="c1"># The stitched realizations:</span>
<span class="n">groups</span> <span class="o">=</span> <span class="n">stitched_global_temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;stitching_id&#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">group</span> <span class="ow">in</span> <span class="n">groups</span><span class="p">:</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">group</span><span class="o">.</span><span class="n">year</span><span class="p">,</span> <span class="n">group</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span> <span class="mf">1.0</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="n">name</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;C&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Stitched Global Mean Temperature vs CanESM5 Results&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/output_25_0.png"><img alt="../_images/output_25_0.png" src="../_images/output_25_0.png" style="width: 999px; height: 546px;" /></a>
</section>
</section>
</section>
<section id="example-2-stitching-gridded-products-for-multiple-variables">
<h2>Example 2: stitching gridded products for multiple variables.<a class="headerlink" href="#example-2-stitching-gridded-products-for-multiple-variables" title="Permalink to this heading">#</a></h2>
<p>With the basis of matching illustrated in the example 1, we highlight
especially the structure of the “recipes” <code class="docutils literal notranslate"><span class="pre">stitches</span></code> creates:</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">my_recipes</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="mi">0</span><span class="p">,])</span>
</pre></div>
</div>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">target_start_yr</span>                                                    <span class="mi">1850</span>
<span class="n">target_end_yr</span>                                                      <span class="mi">1858</span>
<span class="n">archive_experiment</span>                                           <span class="n">historical</span>
<span class="n">archive_variable</span>                                                    <span class="n">tas</span>
<span class="n">archive_model</span>                                                   <span class="n">CanESM5</span>
<span class="n">archive_ensemble</span>                                               <span class="n">r1i1p1f1</span>
<span class="n">stitching_id</span>                                          <span class="n">ssp245</span><span class="o">~</span><span class="n">r1i1p1f1</span><span class="o">~</span><span class="mi">1</span>
<span class="n">archive_start_yr</span>                                                   <span class="mi">1850</span>
<span class="n">archive_end_yr</span>                                                     <span class="mi">1858</span>
<span class="n">tas_file</span>              <span class="n">gs</span><span class="p">:</span><span class="o">//</span><span class="n">cmip6</span><span class="o">/</span><span class="n">CMIP6</span><span class="o">/</span><span class="n">CMIP</span><span class="o">/</span><span class="n">CCCma</span><span class="o">/</span><span class="n">CanESM5</span><span class="o">/</span><span class="n">historical</span><span class="o">...</span>
<span class="n">Name</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="n">dtype</span><span class="p">:</span> <span class="nb">object</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">tas_file</span></code> entry points to the specific CMIP6 netcdf file on
pangeo that must be pulled for these years to create a gridded
temperature product. To create a recipe that can produce a gridded
product for multiple variables we will need to use
<code class="docutils literal notranslate"><span class="pre">stitches.make_recipe()</span></code> with the argument <code class="docutils literal notranslate"><span class="pre">non_tas_variables</span></code> set
to the additional variables of interest.</p>
<section id="match-and-stitch">
<h3>Match and stitch<a class="headerlink" href="#match-and-stitch" title="Permalink to this heading">#</a></h3>
<p>As in example 1 set up the target and archive data. We will be using the
same setup for CanESM5 ssp245.</p>
<ul class="simple">
<li><p>Set the <code class="docutils literal notranslate"><span class="pre">non_tas_variables</span></code> = “pr” to indicate that the recipe
should include precipitation results (see
<code class="docutils literal notranslate"><span class="pre">help(stitches.make_recipe)</span></code> for more details on
<code class="docutils literal notranslate"><span class="pre">non_tas_variables</span></code> ). Now the resulting recipe includes
<code class="docutils literal notranslate"><span class="pre">tas_file</span></code> and <code class="docutils literal notranslate"><span class="pre">pr_file</span></code>columns that point to CMIP6 files for
<code class="docutils literal notranslate"><span class="pre">tas</span></code> and <code class="docutils literal notranslate"><span class="pre">pr</span></code> monthly data on pangeo. These files will be pulled
from pangeo and data for these years will be used to create the
gridded data product.</p></li>
<li><p>Variables other than surface air temperature and precipitation may be
considered.</p></li>
<li><p>In this example we will only generate a recipe for one new
realization for expediency, but <code class="docutils literal notranslate"><span class="pre">N_matches</span></code> may be increased with
no changes to the stitching calls below.</p></li>
</ul>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">my_recipes</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">make_recipe</span><span class="p">(</span><span class="n">target_data</span><span class="p">,</span>
                                  <span class="n">archive_data</span><span class="p">,</span>
                                  <span class="n">tol</span><span class="o">=</span><span class="mf">0.06</span><span class="p">,</span>
                                  <span class="n">non_tas_variables</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;pr&#39;</span><span class="p">],</span>
                                  <span class="n">N_matches</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                                  <span class="n">reproducible</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
<p>To stitch new realizations of the gridded data as netcdfs, use the
function <code class="docutils literal notranslate"><span class="pre">gridded_stitching</span></code>. The results are saved in a
user-specified directory. In this example, it is the same directory this
notebook sits in.</p>
<p>These netcdf files may then be read in and examined with <code class="docutils literal notranslate"><span class="pre">xarray</span></code>
functions.</p>
<p>For speed, this block is not executed by default in the quickstart.
Instead, we have pre-built and uploaded these netcdfs for easy
exploration.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">stitches</span><span class="o">.</span><span class="n">gridded_stitching</span><span class="p">(</span><span class="n">out_dir</span><span class="o">=</span><span class="s1">&#39;.&#39;</span><span class="p">,</span>  <span class="n">rp</span><span class="o">=</span><span class="n">my_recipes</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="load-generated-data">
<h3>Load generated data<a class="headerlink" href="#load-generated-data" title="Permalink to this heading">#</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the stitched (generated) temperature (tas) netcdf files</span>
<span class="n">gen_tas</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fetch_quickstarter_data</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s2">&quot;tas&quot;</span><span class="p">)</span>

<span class="c1"># load the stitched pr netcdf file</span>
<span class="n">gen_pr</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fetch_quickstarter_data</span><span class="p">(</span><span class="n">variable</span><span class="o">=</span><span class="s2">&quot;pr&quot;</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="fetch-target-data-from-pangeo-for-comparison">
<h3>Fetch target data from pangeo for comparison<a class="headerlink" href="#fetch-target-data-from-pangeo-for-comparison" title="Permalink to this heading">#</a></h3>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Fetch the actual data directly from pangeo</span>
<span class="n">pangeo_path</span> <span class="o">=</span> <span class="n">pkg_resources</span><span class="o">.</span><span class="n">resource_filename</span><span class="p">(</span><span class="s1">&#39;stitches&#39;</span><span class="p">,</span> <span class="s1">&#39;data/pangeo_table.csv&#39;</span><span class="p">)</span>

<span class="n">pangeo_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">pangeo_path</span><span class="p">)</span>

<span class="n">pangeo_data</span> <span class="o">=</span> <span class="n">pangeo_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;tas&#39;</span><span class="p">,</span> <span class="s1">&#39;pr&#39;</span><span class="p">]))</span>
                              <span class="o">&amp;</span> <span class="p">(</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;domain&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">str</span><span class="o">.</span><span class="n">contains</span><span class="p">(</span><span class="s1">&#39;mon&#39;</span><span class="p">))</span>
                              <span class="o">&amp;</span> <span class="p">(</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;experiment&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;ssp245&#39;</span><span class="p">]))</span>
                              <span class="o">&amp;</span> <span class="p">(</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;ensemble&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;r1i1p1f1&#39;</span><span class="p">]))</span>
                              <span class="o">&amp;</span> <span class="p">(</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;model&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">isin</span><span class="p">([</span><span class="s1">&#39;CanESM5&#39;</span><span class="p">]))]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">pangeo_data</span>
</pre></div>
</div>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>model</th>
      <th>experiment</th>
      <th>ensemble</th>
      <th>variable</th>
      <th>zstore</th>
      <th>domain</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>21843</th>
      <td>CanESM5</td>
      <td>ssp245</td>
      <td>r1i1p1f1</td>
      <td>pr</td>
      <td>gs://cmip6/CMIP6/ScenarioMIP/CCCma/CanESM5/ssp...</td>
      <td>Amon</td>
    </tr>
    <tr>
      <th>21910</th>
      <td>CanESM5</td>
      <td>ssp245</td>
      <td>r1i1p1f1</td>
      <td>tas</td>
      <td>gs://cmip6/CMIP6/ScenarioMIP/CCCma/CanESM5/ssp...</td>
      <td>Amon</td>
    </tr>
  </tbody>
</table>
</div><div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># load the target tas netcdf files</span>
<span class="n">tas_address</span> <span class="o">=</span> <span class="n">pangeo_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span> <span class="s1">&#39;tas&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">zstore</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tar_tas</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fetch_nc</span><span class="p">(</span><span class="n">tas_address</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># load the target pr netcdf files</span>
<span class="n">pr_address</span> <span class="o">=</span> <span class="n">pangeo_data</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">pangeo_data</span><span class="p">[</span><span class="s1">&#39;variable&#39;</span><span class="p">]</span><span class="o">==</span> <span class="s1">&#39;pr&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">zstore</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">tar_pr</span> <span class="o">=</span> <span class="n">stitches</span><span class="o">.</span><span class="n">fetch_nc</span><span class="p">(</span><span class="n">pr_address</span><span class="o">.</span><span class="n">values</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
</pre></div>
</div>
</section>
<section id="visualize">
<h3>Visualize<a class="headerlink" href="#visualize" title="Permalink to this heading">#</a></h3>
<p>Select a grid cell and plot the generated and target tas, pr data for
first-cut comparison</p>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">plot_comparison</span><span class="p">(</span><span class="n">generated_data</span><span class="p">,</span>
                    <span class="n">target_data</span><span class="p">,</span>
                    <span class="n">variable</span><span class="p">,</span>
                    <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Plot comparision between target variable time series and generated data&quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">variable</span><span class="o">.</span><span class="n">casefold</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;pr&quot;</span><span class="p">:</span>
        <span class="n">variable_name</span> <span class="o">=</span> <span class="s2">&quot;precipitation&quot;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;kg m-2 s-1&quot;</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">variable_name</span> <span class="o">=</span> <span class="s2">&quot;temperature&quot;</span>
        <span class="n">units</span> <span class="o">=</span> <span class="s2">&quot;C&quot;</span>

    <span class="c1"># temperature (tas)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">generated_data</span><span class="o">.</span><span class="n">time</span><span class="p">,</span>
             <span class="n">generated_data</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
             <span class="n">label</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Generated monthly </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">warnings</span><span class="o">.</span><span class="n">catch_warnings</span><span class="p">():</span>
        <span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">target_data</span><span class="o">.</span><span class="n">indexes</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_datetimeindex</span><span class="p">(),</span>
                 <span class="n">target_data</span><span class="p">[</span><span class="n">variable</span><span class="p">],</span>
                 <span class="n">alpha</span><span class="o">=</span><span class="n">alpha</span><span class="p">,</span>
                 <span class="n">label</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Target monthly </span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Year&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="n">units</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Actual and generated monthly </span><span class="si">{</span><span class="n">variable_name</span><span class="si">}</span><span class="s2"> (</span><span class="si">{</span><span class="n">variable</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
</div>
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># lon and lat values for a grid cell near the Joint Global Change Research Institute in College Park, MD, USA</span>
<span class="n">cp_lat</span> <span class="o">=</span> <span class="mf">38.9897</span>
<span class="n">cp_lon</span> <span class="o">=</span> <span class="mi">180</span> <span class="o">+</span> <span class="mf">76.9378</span>

<span class="c1"># lat and lon coordinates closest</span>
<span class="n">abslat</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gen_tas</span><span class="o">.</span><span class="n">lat</span> <span class="o">-</span> <span class="n">cp_lat</span><span class="p">)</span>
<span class="n">abslon</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">gen_tas</span><span class="o">.</span><span class="n">lon</span><span class="o">-</span><span class="n">cp_lon</span><span class="p">)</span>
<span class="n">c</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">maximum</span><span class="p">(</span><span class="n">abslon</span><span class="p">,</span> <span class="n">abslat</span><span class="p">)</span>
<span class="p">([</span><span class="n">lon_loc</span><span class="p">],</span> <span class="p">[</span><span class="n">lat_loc</span><span class="p">])</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">c</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">min</span><span class="p">(</span><span class="n">c</span><span class="p">))</span>
<span class="n">lon_grid</span> <span class="o">=</span> <span class="n">gen_tas</span><span class="o">.</span><span class="n">lon</span><span class="p">[</span><span class="n">lon_loc</span><span class="p">]</span>
<span class="n">lat_grid</span> <span class="o">=</span> <span class="n">gen_tas</span><span class="o">.</span><span class="n">lat</span><span class="p">[</span><span class="n">lat_loc</span><span class="p">]</span>

<span class="n">cp_tas_gen</span> <span class="o">=</span> <span class="n">gen_tas</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span>
                         <span class="n">lat</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">,</span>
                         <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2099-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">cp_tas_tar</span> <span class="o">=</span> <span class="n">tar_tas</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span>
                         <span class="n">lat</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">,</span>
                         <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2099-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">cp_pr_gen</span> <span class="o">=</span> <span class="n">gen_pr</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span>
                       <span class="n">lat</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">,</span>
                       <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2099-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="n">cp_pr_tar</span> <span class="o">=</span> <span class="n">tar_pr</span><span class="o">.</span><span class="n">sel</span><span class="p">(</span><span class="n">lon</span><span class="o">=</span><span class="n">lon_grid</span><span class="p">,</span>
                       <span class="n">lat</span><span class="o">=</span><span class="n">lat_grid</span><span class="p">,</span>
                       <span class="n">time</span><span class="o">=</span><span class="nb">slice</span><span class="p">(</span><span class="s1">&#39;2015-01-01&#39;</span><span class="p">,</span> <span class="s1">&#39;2099-12-31&#39;</span><span class="p">))</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># temperature (tas)</span>
<span class="n">plot_comparison</span><span class="p">(</span><span class="n">generated_data</span><span class="o">=</span><span class="n">cp_tas_gen</span><span class="p">,</span>
                <span class="n">target_data</span><span class="o">=</span><span class="n">cp_tas_tar</span><span class="p">,</span>
                <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;tas&quot;</span><span class="p">)</span>

<span class="c1"># precipitation (pr)</span>
<span class="n">plot_comparison</span><span class="p">(</span><span class="n">generated_data</span><span class="o">=</span><span class="n">cp_pr_gen</span><span class="p">,</span>
                <span class="n">target_data</span><span class="o">=</span><span class="n">cp_pr_tar</span><span class="p">,</span>
                <span class="n">variable</span><span class="o">=</span><span class="s2">&quot;pr&quot;</span><span class="p">)</span>
</pre></div>
</div>
<a class="reference internal image-reference" href="../_images/output_40_0.png"><img alt="../_images/output_40_0.png" src="../_images/output_40_0.png" style="width: 1005px; height: 546px;" /></a>
<a class="reference internal image-reference" href="../_images/output_40_1.png"><img alt="../_images/output_40_1.png" src="../_images/output_40_1.png" style="width: 988px; height: 546px;" /></a>
<p>Visual validation of the complex spatial, temporal, and cross-variable
relationships present in ESM outputs is not possible. We extensively
validate that the method reproduces ESM internal variability in the ESD
paper, but this visual plotting at least suggests that nothing is
obviously wrong.</p>
<p>In other words, it’s not inconceivable from these plots that the orange
time series were sampled from the same underlying multivariate
distribution that generated the blue time series.</p>
</section>
</section>
</section>


              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="installation.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Installation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="tutorial.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Tutorial</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Abigail Snyder; Kalyn Dorheim; Claudia Tebaldi<br/>
  
      &copy; Copyright 2022-current, Battelle Memorial Institute.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>