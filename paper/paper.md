---
title: "STITCHES: a Python package to amalgamate existing Earth system model output into new scenario realizations"
tags:
  - Python
  - earth system models
  - emulation
  - internal variability
authors:
  - name: Abigail C. Snyder
    orcid: 0000-0002-9034-9948
    affiliation: 1
  - name: Kalyn R. Dorheim
    orcid: 0000-0001-8093-8397
    affiliation: 1
  - name: Claudia Tebaldi
    orcid: 0000-0001-9233-8903
    affiliation: 1
  - name: Chris R. Vernon
    orcid: 0000-0002-3406-6214
    affiliation: 2
affiliations:
  - name: Joint Global Change Research Institute/Pacific Northwest National Laboratory, USA
    index: 1
  - name: Pacific Northwest National Laboratory, USA
    index: 2
date:
bibliography: paper.bib

---

# Summary

Understanding the interaction between humans and the Earth system is a
computationally daunting task, with many possible approaches depending on
resources available and questions of interest. For example, state-of-the-art
impact models require decade-long time series of relatively high frequency,
spatially resolved and often multiple variables representing climatic impact-drivers
[@ruane2022climatic]. Most commonly these are derived from the outputs
of  detailed, computationally expensive Earth System Models (ESMs) run according
to a standard, limited set of future scenarios, the latest being the SSP-RCPs
run under CMIP6/ScenarioMIP [@Eyringetal2016;@ONeilletal2016]. At the time of
writing, @ONeilletal2016 has been cited more than 1750 times and @Eyringetal2016
more than 5000 times, highlighting the broad, general applications of this data.


Often, however, impact modeling seeks to explore new scenarios that were not
part of the ScenarioMIP protocol, and/or needs a larger set of initial condition
ensemble members than are typically available to quantify the effects of ESM
internal variability. In addition, the recognition that the human and Earth
systems are fundamentally intertwined, and may feature potentially
significant feedback loops, is making integrated, simultaneous modeling of
the coupled human-Earth system increasingly necessary, if computationally
challenging with most existing tools [@thornton2017biospheric].


For impact modelers, climate model emulators can be the answer to meet both
the needs of: 1) creating realizations for novel scenarios and 2) achieving a
simplified, computationally tractable representation of ESM behavior in a
coupled human-Earth system modeling framework. We proposed a new,
comprehensive approach to such emulation of gridded, multivariate ESM
outputs for novel scenarios without the computational cost of a full ESM,
STITCHES [@tebaldi2022stitches]. The approach outlined in @tebaldi2022stitches should
be extensible to future CMIP eras, although the `STITCHES` software at present 
is strictly focused on CMIP6/ScenarioMIP data hosted on Pangeo 
(https://gallery.pangeo.io/repos/pangeo-gallery/cmip6/). 


The corresponding `STITCHES` Python package uses existing archives of ESMs’  
scenario experiments from CMIP6/ScenarioMIP to construct gridded, multivariate 
realizations of new scenarios provided by reduced complexity climate models 
[@hartin2015simple;@meinshausen2011emulating;@smith2018fair], or to 
enrich existing initial condition ensembles. Its output provides the same
characteristics as the emulated ESM output: multivariate (spanning 
potentially all variables that the ESM has saved), spatially resolved (down to 
the native grid of the ESM), and preserving the same high frequency as the original data.
A new realization of multiple variables can be generated on the order of minutes with 
`STITCHES`, rather than the hours or sometimes days that ESMs require. 



# Statement of need

ESM emulation methods generally attempt to preserve the complex statistical
characteristics of a particular ESM’s outputs for multiple variables and at 
time scales (often daily or monthly) relevant to impact models. Many 
existing ESM emulation methods, such as MESMER 
[@beusch2020emulating;@nath2022mesmer;@quilcaille2022showcasing], rely 
on 'bottom up' methods, inferring from the ESM outputs available for training the
details of some  statistical process (or, more recently, a machine learning algorithm)
able to generate new realizations with the same spatiotemporal behavior of the original
ESM outputs, using as input in the generative phase only large scale information,
like global average temperature (GSAT), that can be generated by a reduced complexity
model, such as Hector, MAGICC, or FAIR
[@hartin2015simple;@meinshausen2011emulating;@smith2018fair].


The STITCHES approach instead takes a top-down approach inspired by the warming-level
style of analyses used by past Intergovernmental Panel on Climate Change
reports [@SR15;@arias2021climate;@masson2021ipcc;@core2023ipcc]. Specifically,
`STITCHES` takes existing ESM output and intelligently recombines time windows
of these gridded, multivariate outputs into new instances of transient, 21st
century trajectories by stitching them together on the basis of a target GSAT
trajectory. The latter can represent an existing scenario (i.e., one that the
ESM has run) or a new one that a simple model can produce, as long as the latter
is intermediate to existing ones in forcing levels/GSAT. We encourage users to
see the flowchart included in the `STITCHES` 
[quickstart notebook](https://github.com/JGCRI/stitches/blob/main/notebooks/stitches-quickstart.ipynb) 
and [website](https://jgcri.github.io/stitches/), as well as in @tebaldi2022stitches, for a visual example of this process.
@tebaldi2022stitches of course contains the full details as well as more illustrative figures.


Research from the climate science  community has indicated that many ESM output
variables are tightly dependent upon the GSAT trajectory and thus scenario
independent (see @SR15 and citations therein, in particular @james2017characterizing), justifying our approach. Thus, the statistical
characteristics of ESM output are preserved by the construction process `STITCHES`
implements, as outlined in @tebaldi2022stitches. One of the major benefits of this
top-down approach is that it jointly emulates outputs of multiple ESM variables,
maintaining by construction the joint behavior of the original ESM output,
something not presently available in other packages to our knowledge. Most
impact-relevant atmospheric variables such as temperature, precipitation, relative
humidity, and sea level pressure can be emulated by `STITCHES` as they are
scenario-independent and have a short memory (compared to the window used by
`STITCHES`, presently set to nine (9) years). Any variable that the ESM has archived can
be emulated jointly. Variables that represent the cumulative effect of warming,
such as sea level rise, or that have a long memory, like glacier mass loss or
mega-drought, cannot be emulated with `STITCHES`. `STITCHES` can produce new
realizations for variables archived by the ESM, but it can produce only finitely
many new realizations, the maximum number depending on the number of runs
archived by each ESM. Currently, new realizations from `STITCHES` can be
appended to archived ESM realizations to result in  double to triple the number
of runs available; this is arguably one of the main differences from the above-mentioned
bottom-up approaches, which can generate infinite new realizations
once an accurate statistical process is estimated from existing data. We see
this as a source of complementarity between these two emulation approaches.

The `STITCHES` Python package currently relies on close integration with the
Pangeo Cloud catalog of CMIP6 ESM outputs (https://gallery.pangeo.io/repos/pangeo-gallery/cmip6/).
Thanks to this integration, users are not required to pre-download the entire
CMIP6/ScenarioMIP archive of ESM outputs, and can quickly and flexibly
emulate variables from any of the 40 ESMs participating in ScenarioMIP.
In addition to the requirements for working with Pangeo in Python, `STITCHES`
relies only on a few common scientific Python packages, namely `xarray`, `numpy`,
`pandas`, `scikit-learn`
[@Hoyer_xarray_N-D_labeled_2017;@harris2020array;@reback2020pandas;@scikit-learn],
which are specified required dependencies in the package.
Finally, because `STITCHES` is intended for use by  impact modelers, the new
realizations generated by `STITCHES` are NetCDF files with the same dimension
information and generally identical structure to the original CMIP6 ESM outputs.
These outputs from `STITCHES` can then serve as inputs to impact models with
little to no code changes in the impact models. It may also be possible to
endogenize climate impacts in scenario construction by coupling `STITCHES`
with impact models for multiple sectors and a reduced complexity climate model
such as Hector, MAGICC, or FAIR
[@hartin2015simple;@meinshausen2011emulating;@smith2018fair].
With the computational efficiency of using emulators,
it may be possible to interactively develop new scenarios with more insight than
would otherwise be possible using multimodel ESM ensemble statistics or using
off-the-shelf ESM scenarios alone.



# Code availability 

The `STITCHES` GitHub repository (https://github.com/JGCRI/stitches) provides 
installation instructions.

Also included is a [quickstart notebook](https://github.com/JGCRI/stitches/blob/main/notebooks/stitches-quickstart.ipynb) that serves as a tutorial for using the package.


# Acknowledgements

This research was supported by the U.S. Department of Energy, Office of Science, as part of research in MultiSector Dynamics, Earth and Environmental System Modeling Program.

# References
